<% cache rich_snippet do %>
  <div class="rich-snippet" itemscope itemtype="http://schema.org/Service">
    <h4 itemprop="name"><%= rich_snippet.title %></h4>
    <% if rich_snippet.description.present? %>
      <div itemprop="description"><%= rich_snippet.description %></div>
    <% end %>

    <div class="rich-snippet-rating">
      <div class="rich-snippet-star-mask">
        <div class="rich-snippet-star-mask__highlight"
              style="width: calc(<%= number_to_percentage((rich_snippet.rating_value.to_s.tr('.', '').to_i * 2)) %>)">
        </div>
        <%= image_tag 'components/rich-snippets/star-mask.png',
                      alt: "#{rich_snippet.rating_value} out of 5",
                      class: 'rich-snippet-star-mask__stars' %>
      </div>
    </div>

    <%#= image_tag "components/rich-snippets/#{rich_snippet.rating_value.to_s.tr('.', '')}.png", alt: "#{rich_snippet.rating_value} out of 5" %>

    <div itemprop="aggregateRating" itemscope itemtype="http://schema.org/AggregateRating">
      <div class="rich-snippet__rating">
        <span itemprop="ratingValue"><%= rich_snippet.rating_value %></span>
        <meta itemprop="bestRating" content="5"/>
        <meta itemprop="worstRating" content="1"/>
        out of 5 based on <span itemprop="ratingCount"><%= rich_snippet.rating_count %></span> ratings
      </div>
    </div>
  </div>
<% end %>
